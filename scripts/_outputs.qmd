## Row {height=20%}

```{r}
#| content: valuebox
#| icon: person-fill
#| color: "secondary"
list(title = switch(lang, et = "Aktiivseid kasutajaid", en = "Active users", ru = "Aктивные пользователи"), value = active_users_n)
```


```{r}
#| content: valuebox
#| icon: file-medical-fill
#| color: "secondary"
list(title = switch(lang, et = "Gripilaadne haigus", en = "Influenza like illness", ru = "Гриппоподобное заболевание"), value = ili_last)
```


## Row {height=55%}

```{r}
#| title: !expr 'switch(lang, et = "Aktiivseid kasutajaid (nädalas)", en = "Active users (weekly)", ru = "Aктивные пользователи (в неделю)")'
active_users_p
```


```{r}
symptoms_transl <- symptoms_lang %>%
  filter(lang == !!lang) %>% 
  group_by(intvl) %>%
  mutate(npid = n_distinct(participantID)) %>% 
  group_by(intvl, symptoms, text, npid) %>% 
  count()
symptoms_p <- symptoms_transl %>%
  filter(!str_detect(symptoms, "No symptoms")) %>%
  symptoms_p_fun() +
    scale_fill_manual(switch(lang, et = "Viimased\nneli nädalat", en = "Last\nfour weeks", ru = "Последние\nчетыре недели"), values = colors)
```


```{r}
nosymptoms_p <- symptoms_transl %>%
  filter(str_detect(symptoms, "No symptoms")) %>%
  nosymptoms_p_fun() +
  labs(
    title = str_wrap(switch(lang, et = "Sümptomiteta kasutajate osakaal", en = "Proportion of users with no symptoms", ru = "Доля пользователей без симптомов"), width = 12)
  )
```


```{r}
#| title: !expr 'switch(lang, et = "Sümptomid", en = "Symptoms", ru = "Симптомы")'
(symptoms_p + nosymptoms_p) + plot_layout(widths = c(0.8, 0.2))
```


## Row

```{r}
#| title: !expr 'title = switch(lang, et = "Gripilaadne haigus", en = "Influenza like illness", ru = "Гриппоподобное заболевание")'
caption <- switch(lang, et = "ILI, isikute osakaal, kes teatasid nii süsteemsest sümptomist (palavik, halb enesetunne, peavalu, lihasvalu) kui ka hingamisteede sümptomist (köha, kurguvalu, õhupuudus), võrreldes nende isikutega, kes teatasid mis tahes sümptomist. Hall riba tähistab 95% usaldusintervalli.", en = "ILI, proportion of individuals reporting both a systemic symptom (fever, malaise, headache, myalgia) and a respiratory symptom (cough, sore throat, shortness of breath) out of those reporting any symptom. Grey ribbon represents 95% CI.", ru = "ILI, Доля лиц, сообщающих как о системных симптомах (лихорадка, недомогание, головная боль, миалгия), так и о респираторных симптомах (кашель, боль в горле, одышка) от числа лиц, сообщающих о каких-либо симптомах. Серая лента представляет 95% доверительный интервал.")
ili_p +
  labs(caption = str_wrap(caption))
```


```{r}
#| title: !expr 'title = switch(lang, et = "Valim", en = "Population", ru = "Выборка")'
gender_p <- demographics_p +
  scale_y_discrete(switch(lang, et = "Vanusegrupp", en = "Age group", ru = "Возрастная группа")) +
  scale_fill_manual(values = colors[3:4],
                    limits = rev,
                    labels = switch(
                      lang,
                      et = c("Naised", "Mehed"),
                      en = c("Female", "Male"),
                      ru = c("Женщины", "Мужчины")
                    )) +
  labs(caption = paste0(
         switch(lang, et = "Sugu 'Muu': ", en = "Gender 'Other': ", ru = "Пол 'Другой': "),
         others,
         " (",
         scales::percent(others / active_users_n),
         ")"
       ))
gender_p
```


```{r}
#| title: !expr 'switch(lang, et = "Kasutajate geograafiline jaotus", en = "Geographic distribution of users", ru = "Географическое распределение пользователей")'
geo_p +
  scico::scale_fill_scico(switch(lang, et = "Kasutajate #", en = "# of users", ru = "# пользователей"), palette = "vanimo")
```

